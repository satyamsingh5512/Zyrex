// Prisma Schema for Career Development Portal
// SQLite Database for Development

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// =====================
// MODELS
// =====================

model User {
  id          String    @id @default(cuid())
  email       String    @unique
  password    String
  name        String?
  role        String    @default("USER") // USER, ADMIN, COMPANY
  resumeUrl   String?   @map("resume_url")
  skills      String    @default("[]") // JSON string for SQLite
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  applications Application[]
  blogs        Blog[]

  @@map("users")
}

model Company {
  id          String    @id @default(cuid())
  name        String
  logoUrl     String?   @map("logo_url")
  website     String?
  description String?
  location    String?
  size        String?   // e.g., "1-10", "11-50", "51-200", "201-500", "500+"
  industry    String?
  isPremium   Boolean   @default(false) @map("is_premium")
  techStack   String    @default("[]") @map("tech_stack") // JSON string
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  jobs        Job[]
  events      Event[]

  @@map("companies")
}

model Job {
  id              String    @id @default(cuid())
  companyId       String    @map("company_id")
  title           String
  type            String    @default("INTERNSHIP") // INTERNSHIP, FULL_TIME, PART_TIME, CONTRACT
  location        String
  stipend         Int       @default(0)
  duration        String?
  techStack       String    @default("[]") @map("tech_stack") // JSON string
  prepGuide       String?   @map("prep_guide") // Rich text/Markdown
  deadline        DateTime
  applyLink       String?   @map("apply_link")
  isInternalApply Boolean   @default(true) @map("is_internal_apply")
  isPPO           Boolean   @default(false) @map("is_ppo")
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  applications Application[]

  @@map("jobs")
}

model Event {
  id          String    @id @default(cuid())
  companyId   String    @map("company_id")
  title       String
  type        String    @default("HACKATHON") // HACKATHON, WORKSHOP, WEBINAR, COMPETITION
  description String?
  rounds      String    @default("[]") // JSON string for SQLite
  teamSizeMin Int       @default(1) @map("team_size_min")
  teamSizeMax Int       @default(4) @map("team_size_max")
  prizePool   String?   @map("prize_pool")
  deadline    DateTime
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("events")
}

model Blog {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  content     String
  excerpt     String?
  coverImage  String?   @map("cover_image")
  tags        String    @default("[]") // JSON string for SQLite
  authorId    String    @map("author_id")
  publishedAt DateTime? @map("published_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  author User @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@map("blogs")
}

model Application {
  id          String    @id @default(cuid())
  userId      String    @map("user_id")
  jobId       String    @map("job_id")
  status      String    @default("PENDING") // PENDING, REVIEWED, SHORTLISTED, REJECTED, ACCEPTED
  answers     String?   // JSON string for SQLite
  submittedAt DateTime  @default(now()) @map("submitted_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  job  Job  @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([userId, jobId]) // One application per user per job
  @@map("applications")
}